<!DOCTYPE html>
<html>
	<head>
		<title>Pull Quotes</title>
		<!-- using http://kenwheeler.github.io/slick/ -->
		<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css"/>
		<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick-theme.css"/>
		<link rel="stylesheet" href="//origami-build.ft.com/v2/bundles/css?modules=o-fonts@^2" />
	   	<style>
			html {
			    font-family: BentonSans, sans-serif;
			}
			h1 {
			    font-family: MillerDisplay, serif;
			    text-align: center;
			    font-size: 300%;
			    font-size: 6.2vw;
			}
			body {
			    background-color: #fff1e0;
			}
			.carousel {
				width: 90% ;
				margin-left: auto ;
				margin-right: auto ;
				height: 90%;
				margin-top: auto;
				margin-bottom: auto;
			}
			.pq-item {
			   display: -webkit-flex;
			   display: flex;
			   -webkit-flex-direction: row;
			   flex-direction: row;
			   flex-wrap: wrap;
			}
			.pq-article {
			}
			.pq-title {
			}
			.pq-date {
			}
			.pq-quote {
			}
			.pq-body {
			    font-size: 100%;
			    font-size: 2vw;
			    text-align: center;
			}
			.pq-attribution {
			    font-size: 100%;
			    font-size: 2vw;
			    text-align: center;
			}
			.instruction {
			    font-size: 200%;
			    font-size: 4vw;
			    text-align: center;
			}
			.footer {
				position: fixed; 
    			bottom: 0%;
    			width: 100%;
			}
			.footer-text {
			    font-size: 200%;
			    font-size: 3vw;
   				width: 90% ;
				margin-left: auto ;
				margin-right: auto ;
			    text-align: right;
			}
   		</style>
		<script type="text/javascript">
			function urlParam(name){
			    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
			    return (results==null)? null : (results[1] || 0);
			}

			function getAndDisplayJson() {
				var jsonUrl = 'https://ftlabs-alignment.herokuapp.com/pullquotes/json?ontology=pages&value=http%3A%2F%2Fwww.ft.com%2Fnews-feed&max=200';
				var secs    = urlParam('pause') * 1 || 5;

				var title = urlParam('title');
				if (title) {
					let titleElement = $('.title');
					titleElement && titleElement.html(decodeURIComponent(title).replace(/"/g,""));
				};
				var footerText = urlParam('footer');
				if (footerText) {
					let footerElement = $('.footer-text');
					footerElement && footerElement.html(decodeURIComponent(footerText).replace(/"/g,""));
				};
				
				var oReq    = new XMLHttpRequest();
				oReq.onload = displayJson;
				oReq.open("get", jsonUrl, true);
				oReq.send();

				function displayJson(e) {
					if (this.status == 200) {
					    var data            = JSON.parse(this.responseText);
					    var htmlList        = [];

					   	data.forEach(function(pq){
					   		var html = `
<div class="pq-item">
	<div class="pq-article">
		<img class="pq-image" src="${pq.ImageUrl}">
		<div class="pq-title">${pq.Title}</div>
		<div class="pq-date">${pq.PubDateString}</div>
	</div>
	<div class="pq-quote">
		<div class="pq-body">${pq.PullQuoteAssets[0].Body}</div>
		<span class="pq-attribution">${pq.PullQuoteAssets[0].Attribution}</div>
	</div>
</div>
`;
					   		htmlList.push( html );
					   	});

					    // var carouselElement = $('.carousel');
					    // carouselElement.html(htmlList);

					    var tempPqElement = $('.temp-pq');
					    tempPqElement.html(htmlList[1]);
					}
				}
			}
		</script>
	</head>
	<body>
		<h1 class="title">Pull Quotes @ FT</h1>
		<div class="temp-pq">
		</div>

		<div class="carousel">
			<div class="pq-item">
				<div class="pq-article">
					<img class="pq-image" src="">
					<div class="pq-title"></div>
					<div class="pq-date"></div>
				</div>
				<div class="pq-quote">
					<div class="pq-body"></div>
					<span class="pq-attribution"></div>
				</div>
			</div>
	   	</div>
	   	<div class="footer">
	   		<div class="footer-text">Financial Times</div>
	   	</div>

		<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

		<script type="text/javascript">
			$(document).ready(getAndDisplayJson);
		</script>

	</body>
</html>
